Name     : tensorflow
Version  : 1.9.0rc2
Release  : 37
URL      : https://github.com/tensorflow/tensorflow/archive/v1.9.0-rc2.tar.gz
Source0  : https://github.com/tensorflow/tensorflow/archive/v1.9.0-rc2.tar.gz

Source10 : https://mirror.bazel.build/bitbucket.org/eigen/eigen/get/e5e305a158a0.tar.gz
Source11 : https://mirror.bazel.build/github.com/abseil/abseil-cpp/archive/9613678332c976568272c8f4a78631a29159271d.tar.gz
Source12 : https://mirror.bazel.build/github.com/hfp/libxsmm/archive/1.9.tar.gz
Source13 : https://mirror.bazel.build/github.com/google/or-tools/archive/253f7955c6a1fd805408fba2e42ac6d45b312d15.tar.gz
Source14 : https://mirror.bazel.build/github.com/google/re2/archive/2018-04-01.tar.gz
Source15 : https://mirror.bazel.build/github.com/GoogleCloudPlatform/google-cloud-cpp/archive/53f822805e77ea7715f5b52c592a162c515c7219.tar.gz
Source16 : https://mirror.bazel.build/github.com/bazelbuild/rules_closure/archive/dbb96841cc0a5fb2664c37822803b06dab20c7d1.tar.gz
Source17 : https://mirror.bazel.build/github.com/google/gemmlowp/archive/38ebac7b059e84692f53e5938f97a9943c120d98.zip
Source18 : https://mirror.bazel.build/github.com/google/farmhash/archive/816a4ae622e964763ca0862d9dbd19324a1eaf45.tar.gz
Source19 : http://mirror.bazel.build/github.com/google/highwayhash/archive/fd3d9af80465e4383162e4a7c5e2f406e82dd968.tar.gz
Source20 : https://mirror.bazel.build/www.nasm.us/pub/nasm/releasebuilds/2.12.02/nasm-2.12.02.tar.bz2
Source21 : https://mirror.bazel.build/github.com/libjpeg-turbo/libjpeg-turbo/archive/1.5.3.tar.gz
Source22 : https://mirror.bazel.build/github.com/glennrp/libpng/archive/v1.6.34.tar.gz
Source23 : https://mirror.bazel.build/www.sqlite.org/2018/sqlite-amalgamation-3230100.zip
Source24 : https://mirror.bazel.build/ufpr.dl.sourceforge.net/project/giflib/giflib-5.1.4.tar.gz
Source25 : https://mirror.bazel.build/pypi.python.org/packages/source/s/six/six-1.10.0.tar.gz
Source26 : https://mirror.bazel.build/pypi.python.org/packages/d8/be/c4276b3199ec3feee2a88bc64810fbea8f26d961e0a4cd9c68387a9f35de/astor-0.6.2.tar.gz
Source27 : https://mirror.bazel.build/pypi.python.org/packages/5c/78/ff794fcae2ce8aa6323e789d1f8b3b7765f601e7702726f430e814822b96/gast-0.2.0.tar.gz
Source28 : https://mirror.bazel.build/pypi.python.org/packages/8a/48/a76be51647d0eb9f10e2a4511bf3ffb8cc1e6b14e9e4fab46173aa79f981/termcolor-1.1.0.tar.gz
Source29 : https://mirror.bazel.build/github.com/abseil/abseil-py/archive/pypi-v0.2.2.tar.gz
Source30 : https://mirror.bazel.build/pypi.python.org/packages/bc/cc/3cdb0a02e7e96f6c70bd971bc8a90b8463fda83e264fa9c5c1c98ceabd81/backports.weakref-1.0rc1.tar.gz
Source31 : https://mirror.bazel.build/github.com/google/protobuf/archive/v3.6.0.tar.gz
Source32 : https://mirror.bazel.build/github.com/google/nsync/archive/1.20.0.tar.gz
Source33 : https://mirror.bazel.build/github.com/gflags/gflags/archive/f8a0efe03aa69b3336d8e228b37d4ccb17324b88.tar.gz
Source34 : https://mirror.bazel.build/ftp.exim.org/pub/pcre/pcre-8.42.tar.gz
Source35 : https://mirror.bazel.build/ufpr.dl.sourceforge.net/project/swig/swig/swig-3.0.8/swig-3.0.8.tar.gz
Source36 : https://mirror.bazel.build/curl.haxx.se/download/curl-7.60.0.tar.gz
Source37 : https://mirror.bazel.build/github.com/grpc/grpc/archive/d184fa229d75d336aedea0041bd59cb93e7e267f.tar.gz
Source38 : https://mirror.bazel.build/github.com/antirez/linenoise/archive/c894b9e59f02203dbe4e2be657572cf88c4230c3.tar.gz
Source39 : https://mirror.bazel.build/github.com/LMDB/lmdb/archive/LMDB_0.9.22.tar.gz
Source40 : https://mirror.bazel.build/github.com/open-source-parsers/jsoncpp/archive/1.8.4.tar.gz
Source41 : https://mirror.bazel.build/github.com/google/boringssl/archive/a0fb951d2a26a8ee746b52f3ba81ab011a0af778.tar.gz
Source42 : https://mirror.bazel.build/zlib.net/zlib-1.2.11.tar.gz
Source43 : https://mirror.bazel.build/www.kurims.kyoto-u.ac.jp/~ooura/fft.tgz
Source44 : https://mirror.bazel.build/github.com/google/snappy/archive/1.1.7.tar.gz
Source45 : https://mirror.bazel.build/github.com/jemalloc/jemalloc/archive/4.4.0.tar.gz
Source46 : https://mirror.bazel.build/github.com/google/pprof/archive/c0fb62ec88c411cc91194465e54db2632845b650.tar.gz
Source47 : https://github.com/google/double-conversion/archive/3992066a95b823efc8ccc1baf82a1cfc73f6e9b8.zip
Source48 : https://mirror.bazel.build/github.com/google/googletest/archive/9816b96a6ddc0430671693df90192bbee57108b6.zip
Source49 : https://github.com/edenhill/librdkafka/archive/v0.11.4.tar.gz
Source50 : https://github.com/aws/aws-sdk-cpp/archive/1.3.15.tar.gz
Source51 : https://github.com/cython/cython/archive/7332cf1b83f1fa5af32749041abd39a6c1564e96.tar.gz
Source52 : https://github.com/NVlabs/cub/archive/1.8.0.zip
Source53 : https://github.com/googleapis/googleapis/archive/f81082ea1e2f85c43649bee26e0d9871d4b41cdb.zip
Source54 : https://github.com/intel/ARM_NEON_2_x86_SSE/archive/0f77d9d182265259b135dad949230ecbf1a2633d.tar.gz
Source55 : https://github.com/google/flatbuffers/archive/v1.9.0.tar.gz
Source56 : https://docs.python.org/2.7/_sources/license.txt


Source101: answers.txt
Source103: MNIST_example.ipynb

Patch1 : cython.patch

#Source104: 0001-enum34-is-only-required-for-Python-3.4.patch

Summary  : No detailed summary available
Group    : Development/Tools
License  : Apache-2.0 GPL-3.0 MPL-2.0-no-copyleft-exception
BuildRequires : pip

BuildRequires : python3-dev
BuildRequires : setuptools
BuildRequires : wheel
BuildRequires : openjdk
BuildRequires : openjdk-dev
BuildRequires : numpy
#BuildRequires : six
#BuildRequires : protobuf
#BuildRequires : protobuf-c
BuildRequires : bazel


Requires: Werkzeug
Requires: Markdown
Requires: bleach
Requires: backports.weakref
Requires: tensorboard
Requires: absl-py
Requires: astor
Requires: grpcio
Requires: gast


%description
TensorFlow

%prep
%setup -q  -n tensorflow-1.9.0-rc2
%patch1 -p1


%build
export LANG=C
export SOURCE_DATE_EPOCH=1485959355

InstallCache() {
	sha256=`sha256sum $1 | cut -f1 -d" "`
	mkdir -p /tmp/cache/content_addressable/sha256/$sha256/
	cp $1 /tmp/cache/content_addressable/sha256/$sha256/file
}

InstallCache %{SOURCE10}
InstallCache %{SOURCE11}
InstallCache %{SOURCE12}
InstallCache %{SOURCE13}
InstallCache %{SOURCE14}
InstallCache %{SOURCE15}
InstallCache %{SOURCE16}
InstallCache %{SOURCE17}
InstallCache %{SOURCE18}
InstallCache %{SOURCE19}


InstallCache %{SOURCE20}
InstallCache %{SOURCE21}
InstallCache %{SOURCE22}
InstallCache %{SOURCE23}
InstallCache %{SOURCE24}
InstallCache %{SOURCE25}
InstallCache %{SOURCE26}
InstallCache %{SOURCE27}
InstallCache %{SOURCE28}
InstallCache %{SOURCE29}


InstallCache %{SOURCE30}
InstallCache %{SOURCE31}
InstallCache %{SOURCE32}
InstallCache %{SOURCE33}
InstallCache %{SOURCE34}
InstallCache %{SOURCE35}
InstallCache %{SOURCE36}
InstallCache %{SOURCE37}
InstallCache %{SOURCE38}
InstallCache %{SOURCE39}


InstallCache %{SOURCE40}
InstallCache %{SOURCE41}
InstallCache %{SOURCE42}
InstallCache %{SOURCE43}
InstallCache %{SOURCE44}
InstallCache %{SOURCE45}
InstallCache %{SOURCE46}
InstallCache %{SOURCE47}
InstallCache %{SOURCE48}
InstallCache %{SOURCE49}

InstallCache %{SOURCE50}
InstallCache %{SOURCE51}
InstallCache %{SOURCE52}
InstallCache %{SOURCE53}
InstallCache %{SOURCE54}
InstallCache %{SOURCE55}
InstallCache %{SOURCE56}


./configure < %{SOURCE101}

bazel --output_base=/tmp/bazel build --repository_cache=/tmp/cache  -c opt --copt=-g1 --copt=-Wno-sign-compare --copt=-O3 //tensorflow/tools/pip_package:build_pip_package
bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp

bazel clean
export TF_BUILD_MAVX=MAVX2
./configure < %{SOURCE101}
mkdir /tmp/avx2
bazel --output_base=/tmp/bazel build --repository_cache=/tmp/cache  -c opt --copt=-mavx2 --copt=-O3 --copt=-march=haswell --copt=-mfma --copt=-g1    //tensorflow/tools/pip_package:build_pip_package
bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/avx2/

bazel clean
export TF_BUILD_MAVX=MAVX512
./configure < %{SOURCE101}
mkdir /tmp/avx512
bazel --output_base=/tmp/bazel build --repository_cache=/tmp/cache  -c opt --copt=-mavx2 --copt=-O3 --copt=-march=skylake-avx512 --copt=-mfma --copt=-g1  //tensorflow/tools/pip_package:build_pip_package
bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/avx512/




%install
export SOURCE_DATE_EPOCH=1485959355

mkdir -p %{buildroot}/usr/lib/python3.7/site-packages/tensorflow/haswell/avx512_1

pip3 install --no-deps  --root %{buildroot} /tmp/avx512/tensorflow-1.9.0rc0-cp37-cp37m-linux_x86_64.whl
for i in `find %{buildroot} -name "*.so" `; do mv $i $i.avx512 ; done
mv %{buildroot}//usr/lib/python3.7/site-packages/tensorflow/libtensorflow_framework.so.avx512 %{buildroot}/usr/lib/python3.7/site-packages/tensorflow/haswell/avx512_1libtensorflow_framework.so

pip3 install --no-deps  --root %{buildroot} /tmp/avx2/tensorflow-1.9.0rc0-cp37-cp37m-linux_x86_64.whl
for i in `find %{buildroot} -name "*.so" `; do mv $i $i.avx2 ; done
mv %{buildroot}//usr/lib/python3.7/site-packages/tensorflow/libtensorflow_framework.so.avx2 %{buildroot}/usr/lib/python3.7/site-packages/tensorflow/haswell/libtensorflow_framework.so


pip3 install --no-deps --force-reinstall  --root %{buildroot} /tmp/tensorflow-1.9.0rc0-cp37-cp37m-linux_x86_64.whl
							           

%files
%defattr(-,root,root,-)
/usr/lib/python3.7/site-packages
/usr/bin/tensorboard
/usr/bin/saved_model_cli
/usr/bin/tflite_convert

#/usr/share/doc/*
/usr/bin/freeze_graph
/usr/bin/toco
/usr/bin/toco_from_protos
