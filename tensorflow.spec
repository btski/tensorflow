Name     : tensorflow
Version  : 1.14.0
Release  : 82
URL      : https://github.com/tensorflow/tensorflow/archive/v1.14.0.tar.gz
Source0  : https://github.com/tensorflow/tensorflow/archive/v1.14.0.tar.gz

Source9 : https://github.com/markdryan/eigen-git-mirror/archive/tf1.13.tar.gz
Source10 : https://bitbucket.org/eigen/eigen/get/a0d250e79c79.tar.gz
Source11 : https://github.com/abseil/abseil-cpp/archive/daf381e8535a1f1f1b8a75966a74e7cca63dee89.tar.gz
Source12 : https://github.com/hfp/libxsmm/archive/1.9.tar.gz
Source13 : https://mirror.bazel.build/github.com/google/or-tools/archive/253f7955c6a1fd805408fba2e42ac6d45b312d15.tar.gz
Source14 : https://github.com/google/re2/archive/2018-10-01.tar.gz
Source15 : https://github.com/googleapis/google-cloud-cpp/archive/v0.9.0.tar.gz
Source16 : https://github.com/bazelbuild/rules_closure/archive/cf1e44edb908e9616030cc83d085989b8e6cd6df.tar.gz
Source17 : https://github.com/google/gemmlowp/archive/12fed0cd7cfcd9e169bf1925bc3a7a58725fdcc3.zip
Source18 : https://mirror.bazel.build/github.com/google/farmhash/archive/816a4ae622e964763ca0862d9dbd19324a1eaf45.tar.gz
Source19 : http://mirror.bazel.build/github.com/google/highwayhash/archive/fd3d9af80465e4383162e4a7c5e2f406e82dd968.tar.gz
Source20 : https://mirror.bazel.build/www.nasm.us/pub/nasm/releasebuilds/2.13.03/nasm-2.13.03.tar.bz2
Source21 : https://github.com/libjpeg-turbo/libjpeg-turbo/archive/2.0.0.tar.gz
Source22 : https://github.com/glennrp/libpng/archive/v1.6.37.tar.gz
Source23 : https://www.sqlite.org/2019/sqlite-amalgamation-3280000.zip
Source24 : https://mirror.bazel.build/ufpr.dl.sourceforge.net/project/giflib/giflib-5.1.4.tar.gz
Source25 : https://mirror.bazel.build/pypi.python.org/packages/source/s/six/six-1.10.0.tar.gz
Source26 : https://files.pythonhosted.org/packages/99/80/f9482277c919d28bebd85813c0a70117214149a96b08981b72b63240b84c/astor-0.7.1.tar.gz
Source27 : https://mirror.bazel.build/pypi.python.org/packages/5c/78/ff794fcae2ce8aa6323e789d1f8b3b7765f601e7702726f430e814822b96/gast-0.2.0.tar.gz
Source28 : https://mirror.bazel.build/pypi.python.org/packages/8a/48/a76be51647d0eb9f10e2a4511bf3ffb8cc1e6b14e9e4fab46173aa79f981/termcolor-1.1.0.tar.gz
Source29 : https://github.com/abseil/abseil-py/archive/pypi-v0.7.1.tar.gz
Source30 : https://mirror.bazel.build/pypi.python.org/packages/bc/cc/3cdb0a02e7e96f6c70bd971bc8a90b8463fda83e264fa9c5c1c98ceabd81/backports.weakref-1.0rc1.tar.gz
Source31 : https://github.com/protocolbuffers/protobuf/archive/5902e759108d14ee8e6b0b07653dac2f4e70ac73.tar.gz
Source32 : https://github.com/google/nsync/archive/1.20.2.tar.gz
Source33 : https://mirror.bazel.build/github.com/gflags/gflags/archive/f8a0efe03aa69b3336d8e228b37d4ccb17324b88.tar.gz
Source34 : https://mirror.bazel.build/ftp.exim.org/pub/pcre/pcre-8.42.tar.gz
Source35 : https://mirror.bazel.build/ufpr.dl.sourceforge.net/project/swig/swig/swig-3.0.8/swig-3.0.8.tar.gz
Source36 : https://curl.haxx.se/download/curl-7.65.1.tar.gz
Source37 : https://github.com/grpc/grpc/archive/4566c2a29ebec0835643b972eb99f4306c4234a3.tar.gz
Source38 : https://mirror.bazel.build/github.com/antirez/linenoise/archive/c894b9e59f02203dbe4e2be657572cf88c4230c3.tar.gz
Source39 : https://github.com/LMDB/lmdb/archive/LMDB_0.9.22.tar.gz
Source40 : https://github.com/open-source-parsers/jsoncpp/archive/1.8.4.tar.gz
Source41 : https://github.com/google/boringssl/archive/7f634429a04abc48e2eb041c81c5235816c96514.tar.gz
Source42 : https://mirror.bazel.build/zlib.net/zlib-1.2.11.tar.gz
Source43 : https://mirror.bazel.build/www.kurims.kyoto-u.ac.jp/~ooura/fft.tgz
Source44 : https://mirror.bazel.build/github.com/google/snappy/archive/1.1.7.tar.gz
Source45 : https://mirror.bazel.build/github.com/jemalloc/jemalloc/archive/4.4.0.tar.gz
Source46 : https://mirror.bazel.build/github.com/google/pprof/archive/c0fb62ec88c411cc91194465e54db2632845b650.tar.gz
Source47 : https://github.com/google/double-conversion/archive/3992066a95b823efc8ccc1baf82a1cfc73f6e9b8.zip
Source48 : https://mirror.bazel.build/github.com/google/googletest/archive/9816b96a6ddc0430671693df90192bbee57108b6.zip
Source49 : https://github.com/edenhill/librdkafka/archive/v0.11.5.tar.gz
Source50 : https://github.com/aws/aws-sdk-cpp/archive/1.5.8.tar.gz
Source51 : https://mirror.bazel.build/github.com/cython/cython/archive/0.28.4.tar.gz
Source52 : https://github.com/NVlabs/cub/archive/1.8.0.zip
Source53 : https://github.com/googleapis/googleapis/archive/f81082ea1e2f85c43649bee26e0d9871d4b41cdb.zip
Source54 : https://github.com/intel/ARM_NEON_2_x86_SSE/archive/1200fe90bb174a6224a525ee60148671a786a71f.tar.gz
Source55 : https://github.com/google/flatbuffers/archive/v1.11.0.tar.gz
Source57 : http://ftp.exim.org/pub/pcre/pcre-8.39.tar.gz
Source58 : https://github.com/unicode-org/icu/archive/release-62-1.tar.gz
Source59 : https://github.com/llvm-mirror/llvm/archive/558b52b517b8c989dc2d7fffb5c580fa45aece34.tar.gz
Source60 : https://github.com/bazelbuild/bazel-toolchains/archive/94d31935a2c94fe7e7c7379a0f3393e181928ff7.tar.gz
Source61 : https://github.com/bazelbuild/rules_docker/archive/b8ff6a85ec359db3fd5657accd3e524daf12016d.tar.gz
Source62 : https://github.com/bazelbuild/bazel-skylib/archive/0.6.0.tar.gz
Source63 : https://github.com/bazelbuild/rules_apple/archive/0.13.0.tar.gz
Source64 : http://mirror.bazel.build/github.com/keras-team/keras-applications/archive/1.0.6.tar.gz
Source65 : https://github.com/nanopb/nanopb/archive/f8ac463766281625ad710900479130c7fcb4d63b.tar.gz
Source67 : https://github.com/bazelbuild/rules_swift/releases/download/0.9.0/rules_swift.0.9.0.tar.gz
Source68 : https://github.com/GrahamDumpleton/wrapt/archive/1.11.1.tar.gz
Source69 : https://github.com/google/pasta/archive/v0.1.2.tar.gz
Source70 : https://pypi.python.org/packages/bf/3e/31d502c25302814a7c2f1d3959d2a3b3f78e509002ba91aea64993936876/enum34-1.1.6.tar.gz
Source71 : https://download.open-mpi.org/release/hwloc/v2.0/hwloc-2.0.3.tar.gz
Source72 : https://github.com/intel/mkl-dnn/archive/v0.18.tar.gz
Source73 : https://docs.python.org/2.7/_sources/license.rst.txt

Source101: answers.txt
Source103: MNIST_example.ipynb

Patch2 : setuptools.patch
Patch3 : 0001-Patch-Eigen-for-TF-1.13.patch
Patch4 : 0001-fixed-curl-dependency-issue.patch
Patch5 : 0001-Updated-curl.patch
Patch6 : Add-grpc-fix-for-gettid.patch

#Source104: 0001-enum34-is-only-required-for-Python-3.4.patch

Summary  : No detailed summary available
Group    : Development/Tools
License  : Apache-2.0 GPL-3.0 MPL-2.0-no-copyleft-exception
BuildRequires : pip

BuildRequires : python3-dev
BuildRequires : setuptools
BuildRequires : wheel
BuildRequires : openjdk
BuildRequires : openjdk-dev
BuildRequires : numpy
#BuildRequires : six
#BuildRequires : protobuf
#BuildRequires : protobuf-c
BuildRequires : bazel
BuildRequires : Keras
BuildRequires : Keras_Applications
BuildRequires : Keras_Preprocessing
BuildRequires : mkl-dnn-dev
BuildRequires : c-ares-dev




Requires: Werkzeug
Requires: Markdown
Requires: bleach
Requires: backports.weakref
Requires: tensorboard
Requires: absl-py
Requires: astor
Requires: grpcio
Requires: gast
Requires : Keras
Requires : Keras_Applications
Requires : Keras_Preprocessing
Requires : termcolor
Requires : wrapt
Requires : google-pasta


%description
TensorFlow

%prep
%setup -q  -n tensorflow-1.14.0

#%patch2 -p1
#%patch3 -p1
%patch4 -p1
%patch5 -p1
%patch6 -p1

%build
export LANG=C
export SOURCE_DATE_EPOCH=1485959355

InstallCache() {
	sha256=`sha256sum $1 | cut -f1 -d" "`
	mkdir -p /tmp/cache/content_addressable/sha256/$sha256/
	cp $1 /tmp/cache/content_addressable/sha256/$sha256/file
}

InstallCache %{SOURCE10}
InstallCache %{SOURCE11}
InstallCache %{SOURCE12}
InstallCache %{SOURCE13}
InstallCache %{SOURCE14}
InstallCache %{SOURCE15}
InstallCache %{SOURCE16}
InstallCache %{SOURCE17}
InstallCache %{SOURCE18}
InstallCache %{SOURCE19}


InstallCache %{SOURCE20}
InstallCache %{SOURCE21}
InstallCache %{SOURCE22}
InstallCache %{SOURCE23}
InstallCache %{SOURCE24}
InstallCache %{SOURCE25}
InstallCache %{SOURCE26}
InstallCache %{SOURCE27}
InstallCache %{SOURCE28}
InstallCache %{SOURCE29}


InstallCache %{SOURCE30}
InstallCache %{SOURCE31}
InstallCache %{SOURCE32}
InstallCache %{SOURCE33}
InstallCache %{SOURCE34}
InstallCache %{SOURCE35}
InstallCache %{SOURCE36}
InstallCache %{SOURCE37}
InstallCache %{SOURCE38}
InstallCache %{SOURCE39}


InstallCache %{SOURCE40}
InstallCache %{SOURCE41}
InstallCache %{SOURCE42}
InstallCache %{SOURCE43}
InstallCache %{SOURCE44}
InstallCache %{SOURCE45}
InstallCache %{SOURCE46}
InstallCache %{SOURCE47}
InstallCache %{SOURCE48}
InstallCache %{SOURCE49}

InstallCache %{SOURCE50}
InstallCache %{SOURCE51}
InstallCache %{SOURCE52}
InstallCache %{SOURCE53}
InstallCache %{SOURCE54}
InstallCache %{SOURCE55}
InstallCache %{SOURCE57}
InstallCache %{SOURCE58}
InstallCache %{SOURCE59}
InstallCache %{SOURCE60}
InstallCache %{SOURCE61}
InstallCache %{SOURCE62}
InstallCache %{SOURCE63}
InstallCache %{SOURCE64}
InstallCache %{SOURCE65}
InstallCache %{SOURCE67}
InstallCache %{SOURCE68}
InstallCache %{SOURCE69}
InstallCache %{SOURCE70}
InstallCache %{SOURCE71}
InstallCache %{SOURCE72}
InstallCache %{SOURCE73}


./configure < %{SOURCE101}

bazel --output_base=/tmp/bazel build --repository_cache=/tmp/cache  --config=opt --copt=-O3 --copt=-Wno-sign-compare  --incompatible_no_support_tools_in_action_inputs=false   //tensorflow/tools/pip_package:build_pip_package
bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp

bazel clean
export TF_BUILD_MAVX=MAVX2
./configure < %{SOURCE101}
mkdir /tmp/avx2
bazel --output_base=/tmp/bazel build --repository_cache=/tmp/cache  --config=opt --copt=-O3 --copt=-mavx2 --copt=-march=haswell --copt=-mfma  --incompatible_no_support_tools_in_action_inputs=false    //tensorflow/tools/pip_package:build_pip_package
bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/avx2/

bazel clean
export TF_BUILD_MAVX=MAVX512
./configure < %{SOURCE101}
mkdir /tmp/avx512
bazel --output_base=/tmp/bazel build --repository_cache=/tmp/cache  --config=opt --copt=-O3 --copt=-mavx2 --copt=-march=skylake-avx512 --copt=-mfma  --incompatible_no_support_tools_in_action_inputs=false   //tensorflow/tools/pip_package:build_pip_package
bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/avx512/

%install
export SOURCE_DATE_EPOCH=1485959355

pip3 install --no-deps --user --force-reinstall /tmp/avx512/tensorflow-1.14.0-cp37-cp37m-linux_x86_64.whl
for i in `find /builddir/.local/ -name "*.so.1" `; do mv $i $i.avx512 ; done
mkdir -p /builddir/.local/lib/python3.7/site-packages/tensorflow/haswell/avx512_1
mv /builddir/.local/lib/python3.7/site-packages/tensorflow/libtensorflow_framework.so.1.avx512 /builddir/.local/lib/python3.7/site-packages/tensorflow/haswell/avx512_1/libtensorflow_framework.so.1.avx512 || :

pip3 install --no-deps --user --force-reinstall /tmp/avx2/tensorflow-1.14.0-cp37-cp37m-linux_x86_64.whl
for i in `find /builddir/.local/ -name "*.so.1" `; do mv $i $i.avx2 ; done
mv /builddir/.local/lib/python3.7/site-packages/tensorflow/libtensorflow_framework.so.1.avx2 /builddir/.local/lib/python3.7/site-packages/tensorflow/haswell/libtensorflow_framework.so.1.avx2 || :

# Add python examples
mkdir -p %{buildroot}/usr/share/tensorflow/eager/python/
cp -r tensorflow/contrib/eager/python/examples/ %{buildroot}/usr/share/tensorflow/eager/python/

install -m 0644 -D %{SOURCE103} %{buildroot}/usr/share/doc/tensorflow/MNIST_example.ipynb
pip3 install --no-deps --force-reinstall --user /tmp/tensorflow-1.14.0-cp37-cp37m-linux_x86_64.whl
mv /builddir/.local/lib/python3.7/site-packages/tensorflow/haswell/avx512_1/libtensorflow_framework.so.1.avx512 /builddir/.local/lib/python3.7/site-packages/tensorflow/haswell/avx512_1/libtensorflow_framework.so.1
mv /builddir/.local/lib/python3.7/site-packages/tensorflow/haswell/libtensorflow_framework.so.1.avx2 /builddir/.local/lib/python3.7/site-packages/tensorflow/haswell/libtensorflow_framework.so.1
rm /builddir/.local/bin/tf_upgrade_v2
mv /builddir/.local/bin %{buildroot}/usr/
mv /builddir/.local/lib/ %{buildroot}/usr/

%files
%defattr(-,root,root,-)
/usr/bin/freeze_graph
/usr/bin/saved_model_cli
%exclude /usr/bin/tensorboard
/usr/bin/tflite_convert
/usr/bin/toco
/usr/bin/toco_from_protos
/usr/lib/python3.7/site-packages/*
/usr/share/doc/tensorflow/MNIST_example.ipynb
/usr/share/tensorflow
